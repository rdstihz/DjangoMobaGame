class AcGameMenu{constructor(t){this.root=t,this.$menu=$('\n<div class="ac-game-menu">\n    <div class="ac-game-menu-field">\n        \n        <div class="ac-game-menu-field-item ac-game-menu-field-item-singlemode">\n            单人模式\n        </div> \n        <br>\n        <div class="ac-game-menu-field-item ac-game-menu-field-item-multimode">\n            多人模式\n        </div>\n        <br>\n        <div class="ac-game-menu-field-item ac-game-menu-field-item-settings">\n            退出登录\n        </div>\n\n    </div>\n</div>\n'),this.$menu.hide(),this.root.$ac_game.append(this.$menu),this.$singlemode=this.$menu.find(".ac-game-menu-field-item-singlemode"),this.$multimode=this.$menu.find(".ac-game-menu-field-item-multimode"),this.$settings=this.$menu.find(".ac-game-menu-field-item-settings"),this.start()}start(){this.add_listening_events()}add_listening_events(){let t=this;this.$singlemode.click((function(){t.hide(),t.root.playground.show("singleplayer")})),this.$multimode.click((function(){t.hide(),t.root.playground.show("multiplayer")})),this.$settings.click((function(){t.root.settings.logout_remote()}))}show(){this.$menu.show()}hide(){this.$menu.hide()}}let last_timestamp,AC_GAME_OBJECTS=[];class AcGameObject{constructor(){AC_GAME_OBJECTS.push(this),this.has_called_start=!1,this.timedelta=0,this.uuid=this.create_uuid()}create_uuid(){let t="";for(let i=0;i<8;i++){let i=Math.floor(10*Math.random());t+=parseInt(i)}return t}start(){}update(){}late_update(){}on_destory(){}destory(){this.on_destory();for(let t=0;t<AC_GAME_OBJECTS.length;t++)if(AC_GAME_OBJECTS[t]===this){AC_GAME_OBJECTS.splice(t,1);break}}}let AC_GAME_ANIMATION=function(t){for(let i=0;i<AC_GAME_OBJECTS.length;i++){let s=AC_GAME_OBJECTS[i];s.has_called_start?(s.timedelta=t-last_timestamp,s.update()):(s.start(),s.has_called_start=!0)}for(let t=0;t<AC_GAME_OBJECTS.length;t++){AC_GAME_OBJECTS[t].late_update()}last_timestamp=t,requestAnimationFrame(AC_GAME_ANIMATION)};requestAnimationFrame(AC_GAME_ANIMATION);class ChatField{constructor(t){this.playground=t,this.$history=$('<div class="ac-game-chat-field-history"></div>'),this.$input=$('<input type="text" class="ac-game-chat-field-input">'),this.$history.hide(),this.$input.hide(),this.playground.$playground.append(this.$history),this.playground.$playground.append(this.$input),this.func_id=null,this.start()}start(){this.add_listening_event()}add_listening_event(){let t=this;this.$input.keydown((function(i){if(27===i.which)return t.hide_input(),!1;if(13===i.which){let i=t.playground.root.settings.username,s=t.$input.val();s&&(t.$input.val(""),t.add_message(i,s),t.playground.mps.send_message(i,s))}}))}render_message(t){return $(`<div>${t}</div>`)}add_message(t,i){this.show_history();let s=`[${t}]${i}`;this.$history.append(this.render_message(s)),this.$history.scrollTop(this.$history[0].scrollHeight)}show_history(){let t=this;this.$history.fadeIn(),this.func_id&&clearTimeout(this.func_id),this.func_id=setTimeout((function(){t.$history.fadeOut(),t.func_id=null}),3e3)}show_input(){this.show_history(),this.$input.show(),this.$input.focus()}hide_input(){this.$input.hide(),this.playground.game_map.$canvas.focus()}}class GameMap extends AcGameObject{constructor(t){super(),this.playground=t,this.$canvas=$("<canvas tabindex=0></canvas>"),this.ctx=this.$canvas[0].getContext("2d"),this.ctx.canvas.width=t.width,this.ctx.canvas.height=t.height,this.playground.$playground.append(this.$canvas),this.timestamp=0}start(){this.$canvas.focus()}update(){this.timestamp+=this.timedelta/1e3,this.render()}resize(){this.ctx.canvas.width=this.playground.width,this.ctx.canvas.height=this.playground.height,this.ctx.fillStyle="rgba(0, 0, 0, 1)",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}render(){this.ctx.fillStyle="rgba(0, 0, 0, 0.2)",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}}class NoticeBoard extends AcGameObject{constructor(t){super(),this.playground=t,this.ctx=this.playground.game_map.ctx,this.text="已就绪： 0人",this.displaying=""}start(){}write(t){this.text=t}display(t){this.displaying=t}update(){this.render()}render(){this.ctx.font="20px serif",this.ctx.fillStyle="white",this.ctx.textAlign="center",this.ctx.fillText(this.text,this.playground.width/2,20),""!==this.displaying&&(this.ctx.font="100px serif",this.ctx.fillStyle="white",this.ctx.textAlign="center",this.ctx.fillText(this.displaying,this.playground.width/2,this.playground.height/2))}}class Particle extends AcGameObject{constructor(t,i,s,e,a,h,n,r,l){super(),this.playground=t,this.ctx=this.playground.game_map.ctx,this.x=i,this.y=s,this.radius=e,this.vx=a,this.vy=h,this.color=n,this.speed=r,this.move_length=l,this.friction=.9,this.eps=.001}start(){}update(){if(this.move_length<this.eps||this.speed<this.eps)return this.destory(),!1;let t=Math.min(this.move_length,this.speed*this.timedelta/1e3);this.x+=t*this.vx,this.y+=t*this.vy,this.speed*=this.friction,this.move_length-=t,this.render()}render(){let t=this.playground.scale;this.ctx.beginPath(),this.ctx.arc(this.x*t,this.y*t,this.radius*t,0,2*Math.PI,!1),this.ctx.fillStyle=this.color,this.ctx.fill()}}class Player extends AcGameObject{constructor(t,i,s,e,a,h,n,r,l){super(),this.playground=t,this.ctx=t.game_map.ctx,this.x=i,this.y=s,this.radius=e,this.color=a,this.speed=h,this.character=n,this.vx=0,this.vy=0,this.move_length=0,this.damage_x=0,this.damage_y=0,this.damage_length=0,this.damage_speed=0,this.friction=.9,this.fireballs=[],this.eps=.001,this.cur_skill=null,this.clientX=0,this.clientY=0,"robot"!==this.character&&(this.username=r,this.photo=l,this.img=new Image,this.img.src=this.photo),"me"===this.character&&(this.fireball_coldtime=3,this.fireball_icon=new Image,this.fireball_icon.src="https://cdn.acwing.com/media/article/image/2021/12/02/1_9340c86053-fireball.png",this.blink_coldtime=5,this.blink_icon=new Image,this.blink_icon.src="https://cdn.acwing.com/media/article/image/2021/12/02/1_daccabdc53-blink.png")}start(){this.playground.playercount++,this.playground.noticeboard.write("已就绪: "+this.playground.playercount+"人"),this.playground.playercount>=3&&(this.playground.state="fighting",this.playground.noticeboard.write("Fighting")),"me"==this.character&&this.add_listening_events()}update(){this.update_move(),this.update_attack(),"me"===this.character&&"fighting"===this.playground.state&&this.update_coldtime(),this.render()}update_coldtime(){this.fireball_coldtime-=this.timedelta/1e3,this.blink_coldtime-=this.timedelta/1e3,this.fireball_coldtime<0&&(this.fireball_coldtime=0),this.blink_coldtime<0&&(this.blink_coldtime=0)}update_move(){if(this.damage_speed>.1)this.vx=this.vy=0,this.move_length=0,this.x+=this.damage_x*this.damage_speed*this.timedelta/1e3,this.y+=this.damage_y*this.damage_speed*this.timedelta/1e3,this.damage_speed*=this.friction;else if(this.move_length<this.eps){if(this.move_length=0,"robot"===this.character){let t=Math.random()*this.playground.width/this.playground.scale,i=Math.random();this.move_to(t,i)}}else{let t=Math.min(this.move_length,this.speed*this.timedelta/1e3);this.x+=t*this.vx,this.y+=t*this.vy,this.move_length-=t}}update_attack(){if(this.playground.game_map.timestamp>4&&"robot"===this.character&&Math.random()<1/300){let t=this.playground.players[Math.floor(Math.random()*this.playground.players.length)];if(t!=this){let i=t.x,s=t.y;this.shoot_fireball(i,s)}}}add_listening_events(){let t=this;this.playground.game_map.$canvas.on("contextmenu",(function(){return!1})),this.playground.game_map.$canvas.mousedown((function(i){if("fighting"===t.playground.state){const s=t.ctx.canvas.getBoundingClientRect();let e=(t.clientX-s.left)/t.playground.scale,a=(t.clientY-s.top)/t.playground.scale;3===i.which&&t.move_to(e,a)}})),this.playground.game_map.$canvas.keyup((function(i){if("fighting"===t.playground.state){const s=t.ctx.canvas.getBoundingClientRect();let e=(t.clientX-s.left)/t.playground.scale,a=(t.clientY-s.top)/t.playground.scale;if(81===i.which){if(t.fireball_coldtime>t.eps)return!1;let i=t.shoot_fireball(e,a);t.fireball_coldtime=3,"multiplayer"===t.playground.mode&&t.playground.mps.send_shoot_fireball(e,a,i.uuid)}else if(68===i.which){if(t.blink_coldtime>t.eps)return!1;t.blink_to(e,a),t.blink_coldtime=5,"multiplayer"===t.playground.mode&&t.playground.mps.send_blink_to(e,a)}}})),this.playground.game_map.$canvas.keydown((function(i){if("multiplayer"===t.playground.mode){if(13===i.which)return t.playground.chatfield.show_input(),!1;27===i.which&&t.playground.chatfield.hide_input()}83==i.which&&(t.move_length=0)})),$(window).mousemove((function(i){t.clientX=i.clientX,t.clientY=i.clientY}))}get_dist(t,i,s,e){let a=t-s,h=i-e;return Math.sqrt(a*a+h*h)}move_to(t,i){"multiplayer"===this.playground.mode&&"me"===this.character&&this.playground.mps.send_move_to(t,i),this.move_length=this.get_dist(this.x,this.y,t,i),this.angle=Math.atan2(i-this.y,t-this.x),this.vx=Math.cos(this.angle),this.vy=Math.sin(this.angle)}blink_to(t,i){let s=this.get_dist(this.x,this.y,t,i);s=Math.min(s,.8);let e=Math.atan2(i-this.y,t-this.x);this.x+=s*Math.cos(e),this.y+=s*Math.sin(e),this.move_length=0}shoot_fireball(t,i){let s=Math.atan2(i-this.y,t-this.x),e=Math.cos(s),a=Math.sin(s),h=new FireBall(this.playground,this,this.x,this.y,.01,e,a,"red",.5,.5,.01);return this.fireballs.push(h),h}render(){let t=this.playground.scale;if("robot"!==this.character?(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.x*t,this.y*t,this.radius*t,0,2*Math.PI,!1),this.ctx.stroke(),this.ctx.clip(),this.ctx.drawImage(this.img,(this.x-this.radius)*t,(this.y-this.radius)*t,2*this.radius*t,2*this.radius*t),this.ctx.restore()):(this.ctx.beginPath(),this.ctx.arc(this.x*t,this.y*t,this.radius*t,0,2*Math.PI,!1),this.ctx.fillStyle=this.color,this.ctx.fill()),"me"===this.character){let i=1.5,s=.9,e=.04;this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(i*t,s*t,e*t,0,2*Math.PI,!1),this.ctx.stroke(),this.ctx.clip(),this.ctx.drawImage(this.fireball_icon,(i-e)*t,(s-e)*t,2*e*t,2*e*t),this.ctx.restore(),this.fireball_coldtime>this.eps&&(this.ctx.beginPath(),this.ctx.moveTo(i*t,s*t),this.ctx.arc(i*t,s*t,e*t,0-Math.PI/2,2*Math.PI*(1-this.fireball_coldtime/3)-Math.PI/2,!0),this.ctx.lineTo(i*t,s*t),this.ctx.fillStyle="rgba(0, 0, 255, 0.6)",this.ctx.fill()),i=1.62,s=.9,e=.04,this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(i*t,s*t,e*t,0,2*Math.PI,!1),this.ctx.stroke(),this.ctx.clip(),this.ctx.drawImage(this.blink_icon,(i-e)*t,(s-e)*t,2*e*t,2*e*t),this.ctx.restore(),this.blink_coldtime>this.eps&&(this.ctx.beginPath(),this.ctx.moveTo(i*t,s*t),this.ctx.arc(i*t,s*t,e*t,0-Math.PI/2,2*Math.PI*(1-this.blink_coldtime/5)-Math.PI/2,!0),this.ctx.lineTo(i*t,s*t),this.ctx.fillStyle="rgba(0, 0, 255, 0.6)",this.ctx.fill())}}be_attacked(t,i){let s=20+10*Math.random();for(let t=0;t<s;t++){let t=this.x,i=this.y,s=this.radius*Math.random()*.1,e=2*Math.PI*Math.random(),a=Math.cos(e),h=Math.sin(e),n=this.color,r=10*this.speed,l=this.radius*Math.random()*5;new Particle(this.playground,t,i,s,a,h,n,r,l)}this.radius-=i,this.radius<this.eps&&this.destory(),this.damage_x=Math.cos(t),this.damage_y=Math.sin(t),this.damage_speed=100*i,this.speed*=.8}on_destory(){"me"===this.character&&"fighting"===this.playground.state&&(this.playground.state="over",this.playground.noticeboard.write("over"),this.playground.scoreboard.lose()),"fighting"===this.playground.state&&"me"!==this.character&&2===this.playground.players.length&&(this.playground.state="over",this.playground.noticeboard.write("over"),this.playground.scoreboard.win());for(let t=0;t<this.playground.players.length;t++)if(this===this.playground.players[t]){this.playground.players.splice(t,1);break}}destory_fireball_by_uuid(t){for(let i=0;i<this.fireballs.length;i++)t===this.fireballs[i].uuid&&this.fireballs[i].destory()}receive_attack(t,i,s,e){this.x=t,this.y=i,this.be_attacked(s,e)}}class ScoreBoard extends AcGameObject{constructor(t){super(),this.playground=t,this.ctx=this.playground.game_map.ctx,this.win_img=new Image,this.win_img.src="https://cdn.acwing.com/media/article/image/2021/12/17/1_8f58341a5e-win.png",this.lose_img=new Image,this.lose_img.src="https://cdn.acwing.com/media/article/image/2021/12/17/1_9254b5f95e-lose.png",this.state=null}add_listening_event(){let t=this;this.playground.game_map.$canvas.click((function(i){t.playground.hide(),t.playground.root.menu.show()}))}win(){this.state="win";let t=this;setTimeout((function(){t.add_listening_event()}),1e3)}lose(){this.state="lose";let t=this;setTimeout((function(){t.add_listening_event()}),1e3)}start(){}late_update(){this.render()}render(){let t=this.playground.height/2;"win"===this.state?this.ctx.drawImage(this.win_img,this.playground.width/2-t/2,this.playground.height/2-t/2,t,t):"lose"===this.state&&this.ctx.drawImage(this.lose_img,this.playground.width/2-t/2,this.playground.height/2-t/2,t,t)}}class FireBall extends AcGameObject{constructor(t,i,s,e,a,h,n,r,l,o,d){super(),this.playground=t,this.ctx=this.playground.game_map.ctx,this.player=i,this.x=s,this.y=e,this.radius=a,this.vx=h,this.vy=n,this.color=r,this.speed=l,this.move_length=o,this.damage=d,this.eps=.001}start(){}update(){"enemy"!=this.player.character&&this.update_attack(),this.update_move(),this.render()}update_attack(){for(let t=0;t<this.playground.players.length;t++){let i=this.playground.players[t];if(i!=this.player&&this.is_collision(i)){this.attack(i);break}}}update_move(){if(this.move_length<this.eps)this.move_length=0,this.destory();else{let t=Math.min(this.move_length,this.speed*this.timedelta/1e3);this.x+=this.vx*t,this.y+=this.vy*t,this.move_length-=t}}render(){let t=this.playground.scale;this.ctx.beginPath(),this.ctx.arc(this.x*t,this.y*t,this.radius*t,0,2*Math.PI,!1),this.ctx.fillStyle=this.color,this.ctx.fill()}is_collision(t){let i=this.x-t.x,s=this.y-t.y;return Math.sqrt(i*i+s*s)<=this.radius+t.radius}attack(t){let i=Math.atan2(t.y-this.y,t.x-this.x);"multiplayer"===this.playground.mode&&this.playground.mps.send_attack(t.uuid,t.x,t.y,i,this.damage,this.uuid),t.be_attacked(i,this.damage),this.destory()}on_destory(){let t=this.player.fireballs;for(let i=0;i<t.length;i++)if(t[i]===this){t.splice(i,1);break}}}class MultiPlayerSocket{constructor(t){this.playground=t,this.uuid=t.players[0].uuid,this.ws=new WebSocket("wss://rdstihz.top:444/wss/multiplayer/"),this.start()}send_create_player(t,i,s){this.ws.send(JSON.stringify({event:"create_player",uuid:t,username:i,photo:s}))}receive_create_player(t,i,s){let e=new Player(this.playground,this.playground.width/2/this.playground.scale,.5,.05,"white",.15,"enemy",i,s);e.uuid=t,this.playground.players.push(e)}start(){this.receive()}receive(){let t=this;this.ws.onmessage=function(i){let s=JSON.parse(i.data),e=s.uuid,a=s.event;if(e===t.uuid)return!1;"create_player"===a?t.receive_create_player(e,s.username,s.photo):"move_to"===a?t.receive_move_to(e,s.tx,s.ty):"shoot_fireball"===a?t.receive_shoot_fireball(e,s.tx,s.ty,s.ball_uuid):"attack"===a?t.receive_attack(e,s.attackee_uuid,s.x,s.y,s.angle,s.damage,s.ball_uuid):"blink_to"===a?t.receive_blink_to(e,s.tx,s.ty):"message"===a&&t.receive_message(s.username,s.text)}}get_player_by_uuid(t){let i=this.playground.players;for(let s=0;s<i.length;s++)if(i[s].uuid===t)return i[s];return null}send_move_to(t,i){this.ws.send(JSON.stringify({event:"move_to",uuid:this.uuid,tx:t,ty:i}))}receive_move_to(t,i,s){let e=this.get_player_by_uuid(t);e&&e.move_to(i,s)}send_shoot_fireball(t,i,s){this.ws.send(JSON.stringify({event:"shoot_fireball",uuid:this.uuid,tx:t,ty:i,ball_uuid:s}))}receive_shoot_fireball(t,i,s,e){let a=this.get_player_by_uuid(t);if(a){a.shoot_fireball(i,s).uuid=e}}send_attack(t,i,s,e,a,h){this.ws.send(JSON.stringify({event:"attack",uuid:this.uuid,attackee_uuid:t,x:i,y:s,angle:e,damage:a,ball_uuid:h}))}receive_attack(t,i,s,e,a,h,n){let r=this.get_player_by_uuid(t),l=this.get_player_by_uuid(i);r&&l&&(l.receive_attack(s,e,a,h,n),r.destory_fireball_by_uuid(n))}send_blink_to(t,i){this.ws.send(JSON.stringify({event:"blink_to",uuid:this.uuid,tx:t,ty:i}))}receive_blink_to(t,i,s){let e=this.get_player_by_uuid(t);e&&e.blink_to(i,s)}send_message(t,i){this.ws.send(JSON.stringify({event:"message",uuid:this.uuid,username:t,text:i}))}receive_message(t,i){this.playground.chatfield.add_message(t,i)}}class AcGamePlayground{constructor(t){this.root=t,this.$playground=$('\n<div class="ac-game-playground">\n</div>\n\n'),this.scale=1,this.hide(),this.root.$ac_game.append(this.$playground),this.start()}start(){let t=this,i=this.create_uuid();$(window).on(`resize.${i}`,(function(){t.resize()})),this.root.AcWingOS&&this.root.AcWingOS.api.window.on_close((function(){$(window).off(`resize.${i}`)}))}resize(){let t=Math.min(this.$playground.width()/16,this.$playground.height()/9);this.width=16*t,this.height=9*t,this.scale=this.height,this.game_map&&this.game_map.resize()}create_uuid(){let t="";for(let i=0;i<8;i++){let i=Math.floor(10*Math.random());t+=parseInt(i)}return t}show(t){let i=this;if(this.$playground.show(),this.resize(),this.game_map=new GameMap(this),this.colors=["blue","green","grey","pink","yellow"],this.players=[],this.mode=t,this.state="waiting",this.playercount=0,this.noticeboard=new NoticeBoard(this),this.scoreboard=new ScoreBoard(this),this.chatfield=new ChatField(this),this.players.push(new Player(this,this.width/2/this.scale,.5,.05,"white",.15,"me",this.root.settings.username,this.root.settings.photo)),"singleplayer"===t)for(let t=0;t<5;t++)this.players.push(new Player(this,this.width/2/this.scale,.5,.05,this.get_random_color(),.15,"robot"));else"multiplayer"===t&&(this.mps=new MultiPlayerSocket(this),this.mps.ws.onopen=function(){i.mps.send_create_player(i.players[0].uuid,i.players[0].username,i.players[0].photo)})}hide(){for(;this.players&&this.players.length>0;)this.players[0].destory();this.game_map&&(this.game_map.destory(),this.game_map=null),this.noticeboard&&(this.noticeboard.destory(),this.noticeboard=null),this.scoreboard&&(this.scoreboard.destory(),this.scoreboard=null),this.$playground.empty(),this.$playground.hide()}get_random_color(){return this.colors[Math.floor(Math.random()*this.colors.length)]}}class Settings{constructor(t){this.root=t,this.platform="WEB",this.root.AcWingOS&&(this.platform="ACAPP"),this.username="",this.photo="",this.$settings=$('\n            <div class="ac-game-settings">\n                <div class="ac-game-settings-login">\n                    <div class="ac-game-settings-title">登录</div>\n                    <div class="ac-game-settings-username">\n                        <div class="ac-game-settings-item">\n                        <input type="text" placeholder="用户名">\n                        </div>\n                    </div>\n                    <div class="ac-game-settings-password">\n                        <div class="ac-game-settings-item">\n                            <input type="password" placeholder="密码">\n                        </div>\n                    </div>\n                    <div class="ac-game-settings-submit">\n                        <div class="ac-game-settings-item">\n                            <button>登录</button>\n                        </div>\n                    </div>\n\n                    <div class="ac-game-settings-error-messages">\n                    </div>\n\n                    <div class="ac-game-settings-option">\n                        注册\n                    </div>\n                    <div class="ac-game-settings-third-login ac-game-settings-third-login-acwing">\n                        <img width="30" src="https://rdstihz.top:444/static/images/settings/acwing_logo.png">\n                        <br>\n                        <div>\n                            AcWing一键登录\n                        </div>\n                    </div>\n                    <div class="ac-game-settings-third-login ac-game-settings-third-login-github">\n                        <img width="30" src="https://rdstihz.top:444/static/images/settings/github_logo3.png">\n                        <br>\n                        <div>\n                            Github一键登录\n                        </div>\n                    </div>\n                </div>\n\n\n                <div class="ac-game-settings-register">\n                    <div class="ac-game-settings-title">注册</div>\n                    <div class="ac-game-settings-username">\n                        <div class="ac-game-settings-item">\n                        <input type="text" placeholder="用户名">\n                        </div>\n                    </div>\n                    <div class="ac-game-settings-password ac-game-settings-password-first">\n                        <div class="ac-game-settings-item">\n                            <input type="password" placeholder="密码">\n                        </div>\n                    </div>\n                    <div class="ac-game-settings-password ac-game-settings-password-second">\n                        <div class="ac-game-settings-item">\n                            <input type="password" placeholder="确认密码">\n                        </div>\n                    </div>\n                   <div class="ac-game-settings-submit">\n                        <div class="ac-game-settings-item">\n                            <button>注册</button>\n                        </div>\n                    </div>\n\n                    <div class="ac-game-settings-error-messages">\n\n                    </div>\n                    <div class="ac-game-settings-option">\n                        登录\n                    </div>\n                </div>\n            </div>\n        '),this.$login=this.$settings.find(".ac-game-settings-login"),this.$register=this.$settings.find(".ac-game-settings-register"),this.$login_username=this.$login.find(".ac-game-settings-username input"),this.$login_password=this.$login.find(".ac-game-settings-password input"),this.$login_submit=this.$login.find(".ac-game-settings-submit button"),this.$login_register=this.$login.find(".ac-game-settings-option"),this.$login_error_messages=this.$login.find(".ac-game-settings-error-messages"),this.$register_username=this.$register.find(".ac-game-settings-username input"),this.$register_password=this.$register.find(".ac-game-settings-password-first input"),this.$register_password_confirm=this.$register.find(".ac-game-settings-password-second input"),this.$register_submit=this.$register.find(".ac-game-settings-submit button"),this.$register_login=this.$register.find(".ac-game-settings-option"),this.$register_error_messages=this.$register.find(".ac-game-settings-error-messages"),this.$login.hide(),this.$register.hide(),this.$acwing_login=this.$login.find(".ac-game-settings-third-login-acwing > img"),this.$github_login=this.$login.find(".ac-game-settings-third-login-github > img"),this.root.$ac_game.append(this.$settings),this.start()}start(){"WEB"===this.platform?(this.getinfo(),this.add_listening_events()):this.acapp_login()}add_listening_events(){let t=this;this.add_listening_events_login(),this.add_listening_events_register(),this.$acwing_login.click((function(){t.acwing_login()})),this.$github_login.click((function(){t.github_login()}))}acwing_login(){$.ajax({url:"https://rdstihz.top:444/settings/acwing/web/apply_code/",type:"GET",success:function(t){"success"===t.result&&window.location.replace(t.apply_code_url)}})}github_login(){$.ajax({url:"https://rdstihz.top:444/settings/github/apply_code/",type:"GET",success:function(t){"success"===t.result&&window.location.replace(t.apply_code_url)}})}add_listening_events_login(){let t=this;this.$login_register.click((function(){t.register()})),this.$login_submit.click((function(){t.login_remote()}))}add_listening_events_register(){let t=this;this.$register_login.click((function(){t.login()})),this.$register_submit.click((function(){t.register_remote()}))}getinfo(){let t=this;$.ajax({url:"https://rdstihz.top:444/settings/getinfo/",type:"GET",data:{platform:t.platform},success:function(i){"success"===i.result?(t.username=i.username,t.photo=i.photo,t.hide(),t.root.menu.show()):t.login()}})}acapp_login(){let t=this;$.ajax({url:"https://rdstihz.top:444/settings/acwing/acapp/apply_code/",type:"GET",success:function(i){"success"===i.result&&t.root.AcWingOS.api.oauth2.authorize(i.appid,i.redirect_uri,i.scope,i.state,(function(i){"success"===i.result&&(t.username=i.username,t.photo=i.photo,t.hide(),t.root.menu.show())}))}})}register(){this.$login.hide(),this.$register.show()}login(){this.$register.hide(),this.$login.show()}login_remote(){let t=this,i=this.$login_username.val(),s=this.$login_password.val();this.$login_error_messages.empty(),$.ajax({url:"https://rdstihz.top:444/settings/login/",type:"GET",data:{username:i,password:s},success:function(i){"success"===i.result?location.reload():t.$login_error_messages.html(i.result)}})}register_remote(){let t=this,i=this.$register_username.val(),s=this.$register_password.val(),e=this.$register_password_confirm.val();this.$register_error_messages.empty(),$.ajax({url:"https://rdstihz.top:444/settings/register/",type:"GET",data:{username:i,password:s,password_confirm:e},success:function(i){"success"===i.result?location.reload():t.$register_error_messages.html(i.result)}})}logout_remote(){if("ACAPP"===this.platform)return!1;$.ajax({url:"https://rdstihz.top:444/settings/logout/",type:"GET",success:function(t){"success"===t.result&&location.reload()}})}hide(){this.$settings.hide()}show(){this.$settings.show()}}export class AcGame{constructor(t,i){this.id=t,this.$ac_game=$("#"+t),this.AcWingOS=i,this.settings=new Settings(this),this.menu=new AcGameMenu(this),this.playground=new AcGamePlayground(this),this.start()}start(){}}
